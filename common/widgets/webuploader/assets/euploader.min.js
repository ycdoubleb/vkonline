!function(){define("utils/wskeee.stringutils",[],function(){function StringUtil(){}return StringUtil.createDOM=function(renderer,data){var daName=[],daVal=[],efn=[];for(var i in data)daName.push(i),daVal.push("data."+i);var _renderer="'"+renderer+"'";return _renderer=_renderer.replace(/\{\%/g,"'+"),_renderer=_renderer.replace(/\%\}/g,"+'"),efn.push("(function("),efn.push(daName.join(",")),efn.push("){"),efn.push("return "+_renderer),efn.push("})("),efn.push(daVal.join(",")),efn.push(")"),eval(efn.join(""))},StringUtil}),define("utils/wskeee.logger",[],function(){function e(){}return e.log=function(){console&&console.log&&console.log.apply(this,arguments)},e.error=function(){console&&console.error&&console.error.apply(this,arguments)},e}),define("wskeee",["utils/wskeee.stringutils","utils/wskeee.logger"],function(e,i){return{StringUtils:e,Logger:i}}),define("fileutil",[],function(){function e(){}var i=WebUploader.Base,t=WebUploader.Lib.Md5;WebUploader.Lib.Md5;return e.md5File=function(e,n,o){var a=new t,l=i.Deferred(),r=e;return a.on("progress load",function(e){e=e||{},l.notify(e.total?e.loaded/e.total:1)}),a.on("complete",function(){l.resolve(a.getResult())}),a.on("error",function(e){l.reject(e)}),arguments.length>1&&(n=n||0,o=o||0,n<0&&(n=r.size+n),o<0&&(o=r.size+o),o=Math.min(o,r.size),r=r.slice(n,o)),a.loadFromBlob(r),l.promise()},e}),define("uploader",["wskeee","fileutil"],function(e,i){var t=function(i,t){var n=this;if(this.config=$.extend({name:"files",swf:"/Uploader.swf",server:"/site/upload",checkFile:"/site/check-file",mergeChunks:"/site/merge-chunks",container:"#euploader-container",pick:"#picker",ctlBtn:"#euploader-ctl-btn",resize:!1,chunked:!0,auto:!1,sendAsBinary:!0,formData:{_csrf:"",app_path:"",makeThumb:1}},i),this._newFileNum=0,this._oldFileNum=0,this.view=void 0==t?new euploader.FilelistView:new t,this.view.init(this),"#picker"==n.config.pick){var o="picker"+Math.round(1e7*Math.random());n.config.pick="#"+o,n.view.changePickId(o)}var a=this.uploader=WebUploader.create(this.config);a.on("fileQueued",function(e){n._newFileNum++,n.view.onFileQueued(e)}),a.on("fileDequeued",function(e){n.view.onFileDequeued(e)}),a.on("uploadBeforeSend",function(e,i){i=$.extend(i,e.formData)}),a.on("uploadProgress",function(e,i){n.view.onUploadProgress(e,i)}),a.on("uploadSuccess",function(e,i){n.view.onUploadSuccess(e,i)}),a.on("uploadError",function(e,i){var t="已存在!"==i;t&&a.skipFile(e),n.view.onUploadError(e,i,t)}),a.on("uploadComplete",function(e){n.view.onUploadComplete(e)}),a.on("uploadFinished",function(e){n.view.onUploadFinished(e,!n.isFinish())}),a.on("onFileMd5Progress",function(e,i){n.view.onFileMd5Progress(e,i)}),a.on("onFileMd5Complete",function(e,i){n.view.onFileMd5Complete(e,i)}),a.on("beforeFileQueuedCheckfileNumLimit",function(e,i){return!(n.getFileNum()+1>n.config.fileNumLimit)||(n.alert("warning","警告","超出最大文件个数限制！"),!1)}),a.on("error",function(i){e.Logger.error(i)}),this.alert=function(e,i,t,o,a){n.view.alert(e,i,t,o,a)},this.addCompleteFiles=function(e){for(var i,t=0,o=e.length;t<o;t++)i=e[t],n.view.addItem(i,!0);n._oldFileNum+=e.length},this.destroy=function(){a.destroy(),n.view.destroy()},this.getFileNum=function(){return n._newFileNum+n._oldFileNum},this.clearAll=function(){n.view.clearAll(),n._newFileNum=n._oldFileNum=0},this.setEnabled=function(e){n.view.setEnabled(e)},this.upload=function(){a.upload()},this.stop=function(){a.stop()},this.retry=function(){a.retry()},this.removeFile=function(e,i){i?(n._newFileNum--,a.removeFile(e,!0)):(n._oldFileNum--,n.view.onFileDequeued(e))},this.makeThumb=function(e,i){a.makeThumb(e,i)},this.isFinish=function(){var e=!0;return $.each(a.getFiles(),function(i,t){t.getStatus()==WebUploader.File.Status.ERROR&&"已存在!"==t.statusText||t.getStatus()==WebUploader.File.Status.COMPLETE||(e=!1)}),e}};return t.unRegister=function(){WebUploader.Uploader.unRegister("Wskeee.Uploader")},WebUploader.Uploader.register({name:"Wskeee.Uploader","before-send-file":"beforeSendFile","before-send":"beforeSend","after-send-file":"afterSendFile"},{beforeSendFile:function(e){var t=WebUploader.Deferred(),n=this.owner,o=function(i){n.trigger("onFileMd5Complete",e,i),e.fileMd5||(e.fileMd5=i),$.ajax({type:"POST",url:n.options.checkFile,data:{fileMd5:i,_csrf:n.options["formData._csrf"]},cache:!1,async:!1,timeout:1e3,dataType:"json",success:function(i){i.exist?(e.dbFile=i.result,t.reject("已存在!")):(e.chunkMd5s=i.result,t.resolve())},fail:function(e){t.reject()},error:function(e){t.reject()}})};return null!=e.fileMd5?setTimeout(function(){o(e.fileMd5)},100):i.md5File(e.source).progress(function(i){n.trigger("onFileMd5Progress",e,i)}).then(o),t.promise()},beforeSend:function(e){var i=this.owner,t=WebUploader.Deferred(),n=e.blob,o=e.file,a=e.chunk,l=e.chunks;e.start,e.end,e.total;return o.chunks=l,l>1?i.md5File(n).progress(function(e){}).then(function(i){e.formData={fileMd5:o.fileMd5,chunkMd5:i,chunk:a,chunks:l};var n=o.chunkMd5s,r=!1;r=null!=n&&null!=n[i],r?t.reject():t.resolve()}):(e.formData={fileMd5:o.fileMd5,chunkMd5:o.fileMd5},t.resolve()),t.promise()},afterSendFile:function(e){var i=this.owner,t=WebUploader.Deferred();return $.ajax({type:"POST",url:i.options.mergeChunks,data:$.extend(i.options.formData,{name:e.name,size:e.size,fileMd5:e.fileMd5}),cache:!1,async:!1,timeout:1e3,dataType:"json",success:function(i){null==i.error?(e.dbFile=i.result,t.resolve()):(console.error(i),t.reject())},fail:function(e){t.reject()},error:function(e){t.reject()}}),t.promise()}}),t}),define("filelist.view",["wskeee"],function(e){function i(){var e,i,p,f,h,m=this;this.uploader=null,this.init=function(n){m.uploader=n,e=$(n.config.container),$(t).appendTo(e),i=e.find("#euploader-list tbody"),p=e.find(n.config.ctlBtn),f=e.find(".euploader-btns"),h=e.find(".euploader-root"),p.on("click",function(){var e=p.html();"开始上传"==e||"继续上传"==e?(m.uploader.upload(),p.html("暂停上传")):"暂停上传"==e?(m.uploader.stop(),p.html("继续上传")):"重新上传"==e&&(m.uploader.retry(),p.html("暂停上传"))})},this.changePickId=function(i){e.find("#picker").attr({id:i})},this.onFileQueued=function(e){m.addItem(e,!1)},this.onFileDequeued=function(e){var t="string"==typeof e?e:e.id;i.find("#"+t).remove()},this.onUploadBeforeSend=function(e){},this.onUploadProgress=function(e,t){var n=i.find("#"+e.id),o=n.find(".progress .progress-bar");o.length||(o=n.find(".euploader-item-state").html($(c.createDOM(a,{value:0}))).find(".progress-bar")),n.attr("class","euploader-item-uploading"),n.find(".euploader-item-status").html(s),o.css("width",100*t+"%"),o.html(Math.floor(100*t)+"%")},this.onUploadSuccess=function(e,t){var n=i.find("#"+e.id);n.attr("class","euploader-item-succeed"),n.find(".euploader-item-status").html(d),n.find(".euploader-item-state").html(c.createDOM(o,{text:"已上传"})),n.find(".euploader-item-input input").removeAttr("disabled")},this.onUploadError=function(e,t,n){var a=i.find("#"+e.id);a.find(".euploader-item-input input").removeAttr("disabled"),a.attr("class",n?"euploader-item-exist":"euploader-item-fail"),a.find(".euploader-item-status").html(n?d:u),a.find(".euploader-item-state").html(c.createDOM(o,{text:t||"上传出错"}))},this.onUploadComplete=function(e){},this.onUploadFinished=function(e){p.html(m.uploader.isFinish()?"开始上传":"重新上传")},this.onFileMd5Progress=function(e,t){i.find("#"+e.id).find(".euploader-item-state").html(c.createDOM(o,{text:"正在读取文件信息..."+Math.floor(100*t)+"%"}))},this.onFileMd5Complete=function(e,t){i.find("#"+e.id).find(".euploader-item-input input").attr("value",t),i.find("#"+e.id).find(".euploader-item-state").html(c.createDOM(o,{text:"成功获取文件信息..."}))},this.addItem=function(e,t){i.append(c.createDOM(n,{id:e.id,dbID:t?e.id:e.fileMd5,status:"euploader-item-waiting",name:e.name,files:m.uploader.config.name,statusIcon:t?d:r,state:c.createDOM(o,{text:t?"已上传":"等待上传"}),disabled:t?"":"disabled",value:e.id,size:WebUploader.Base.formatSize(e.size)})),i.find("#"+e.id).find(".euploader-del-btn").on("click",function(){m.uploader.removeFile($(this).attr("data-file"),!t)})},this.clearAll=function(){i.empty()},this.setEnabled=function(e){e?(h.prepend(f),i.find(".euploader-del-btn").show()):(f.remove(),i.find(".euploader-del-btn").hide())},this.destroy=function(){},this.alert=function(e,i,t,n,o){var a=$(c.createDOM(l,{type:e,title:i,content:t}));h.prepend(a),(void 0==n||n)&&setTimeout(function(){a.fadeOut(a.remove)},o||2e3)}}var t='<div class="euploader-root"><div class="euploader-btns"><div id="picker">选择文件</div><a id="euploader-ctl-btn" class="btn btn-default euploader-ctl-btn">开始上传</a></div><div class="euploader-list-container"><table id="euploader-list" class="table table-striped euploader-list"><tbody></tbody></table></div></div>',n='<tr id="{%id%}" class="{%status%}"><td class="euploader-item-input"><input name="{%files%}[]" type="hidden" value="{%value%}" {%disabled%}/></td><td class="euploader-item-status filelist-status state-color"><span>{%statusIcon%}</span></td><td class="euploader-item-filename filelist-filename"><span>{%name%}</span></td><td class="euploader-item-state filelist-state state-color">{%state%}</td><td class="euploader-item-size filelist-size">{%size%}</td><td class="euploader-item-btns filelist-btns"><a class="btn btn-sm btn-danger euploader-del-btn" data-file="{%id%}"><i class="glyphicon glyphicon-trash"></i></a></td></tr>',o="<span>【{%text%}】</span>",a='<div class="progress" style="margin-bottom: 0px;"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">{%value%}</div></div>',l='<div class="alert alert-{%type%} alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>{%title%}!</strong> {%content%}</div>',r='<i class="glyphicon glyphicon-time"></i>',s='<i class="glyphicon glyphicon-upload"></i>',d='<i class="glyphicon glyphicon-ok"></i>',u='<i class="glyphicon glyphicon-remove"></i>',c=e.StringUtils;return i}),define("tile.view",["wskeee"],function(e){function i(){var e,i,f,h,m,v=this,g={};this.uploader=null,this._showInfo=function(e,t,n){var o=i.find("#"+e);clearTimeout(g[e]),(void 0==t||t)&&(g[e]=setTimeout(function(){v._hideInfo.apply(v,[e])},n||1e3)),o.find(".euploader-item-info").animate({top:"0px"},100)},this._hideInfo=function(e,t,n){var o=i.find("#"+e);clearTimeout(g[e]),(o.hasClass("euploader-item-done")||o.hasClass("euploader-item-succeed")||o.hasClass("euploader-item-exist"))&&(void 0==t||t?g[e]=setTimeout(function(){o.find(".euploader-item-info").animate({top:"-30px"},100)},n||1e3):o.find(".euploader-item-info").animate({top:"-30px"},100))},this._getExt=function(e){var i,t,n="other";return e=e.toLowerCase(),$.each(p,function(o,a){for(i=0,t=a.length;i<t;i++)if(e==a[i]){n=o;break}}),n},this._getSuffix=function(e){try{return/(\.(\w+)\?)|(\.(\w+)$)/.exec(e)[0].replace(".","")}catch(e){}return e},this._isVideo=function(e){return"video"==v._getExt(v._getSuffix(e))},this.init=function(n){v.uploader=n,e=$(n.config.container),$(t).appendTo(e),i=e.find("#euploader-list"),f=e.find(n.config.ctlBtn),h=e.find(".euploader-btns"),m=e.find(".euploader-root"),f.on("click",function(){var e=f.html();"开始上传"==e||"继续上传"==e?(v.uploader.upload(),f.html("暂停上传")):"暂停上传"==e?(v.uploader.stop(),f.html("继续上传")):"重新上传"==e&&(v.uploader.retry(),f.html("暂停上传"))})},this.changePickId=function(i){e.find("#picker").attr({id:i})},this.onFileQueued=function(e){v.uploader.makeThumb(e,function(i,t){e.thumb_path=i?"imgs/"+v._getExt(e.source.ext)+".png":t,v.addItem(e,!1)},128,128)},this.onFileDequeued=function(e){var t="string"==typeof e?e:e.id;i.find("#"+t).remove()},this.onUploadBeforeSend=function(e){},this.onUploadProgress=function(e,t){var n=i.find("#"+e.id),o=n.find(".progress .progress-bar");o.length||(o=n.find(".euploader-item-state").html($(c.createDOM(a,{value:0}))).find(".progress-bar")),n.attr("class","tile-item euploader-item-uploading"),n.find(".euploader-item-status").html(s),o.css("width",100*t+"%"),o.html(Math.floor(100*t)+"%")},this.onUploadSuccess=function(e,t){var n=i.find("#"+e.id);n.attr("class","tile-item euploader-item-succeed"),n.find(".euploader-item-status").html(d),n.find(".euploader-item-state").html(c.createDOM(o,{text:"已上传"})),n.find(".euploader-item-input input").removeAttr("disabled")},this.onUploadError=function(e,t,n){var a=i.find("#"+e.id);a.find(".euploader-item-input input").removeAttr("disabled"),a.attr("class",n?"tile-item euploader-item-exist":"tile-item euploader-item-fail"),a.find(".euploader-item-status").html(n?d:u),a.find(".euploader-item-state").html(c.createDOM(o,{text:t||"上传出错"}))},this.onUploadComplete=function(e){v._hideInfo(e.id,!0)},this.onUploadFinished=function(e){f.html(v.uploader.isFinish()?"开始上传":"重新上传")},this.onFileMd5Progress=function(e,t){i.find("#"+e.id).find(".euploader-item-state").html(c.createDOM(o,{text:"读取..."+Math.floor(100*t)+"%"}))},this.onFileMd5Complete=function(e,t){i.find("#"+e.id).find(".euploader-item-input input").attr("value",t),i.find("#"+e.id).find(".euploader-item-state").html(c.createDOM(o,{text:"读取成功"}))},this.addItem=function(e,t){i.append(c.createDOM(n,{id:e.id,dbID:t?e.id:e.fileMd5,status:t?"euploader-item-done":"euploader-item-waiting",name:e.name,files:v.uploader.config.name,statusIcon:t?d:r,state:c.createDOM(o,{text:t?"已上传":"等待上传"}),disabled:t?"":"disabled",value:e.id,size:WebUploader.Base.formatSize(e.size),href:""}));var a=i.find("#"+e.id);if(""==e.thumb_path&&""!=e.path)try{e.thumb_path="imgs/"+v._getExt(v._getSuffix(e.path))+".png"}catch(e){}a.css({background:"url("+e.thumb_path+") no-repeat center center","background-size":"contain"}),e.hasOwnProperty("path")&&v._isVideo(e.path)||a.find(".tile-playicon").css({display:"none"}),a.hover(function(){v._showInfo(e.id,!1)},function(){v._hideInfo(e.id,!0,1e3)}),a.find(".euploader-del-btn").on("click",function(){v.uploader.removeFile($(this).attr("data-file"),!t)}),v._showInfo(e.id)},this.clearAll=function(){i.empty()},this.setEnabled=function(e){e?(m.prepend(h),i.find(".euploader-del-btn").show()):(h.remove(),i.find(".euploader-del-btn").hide())},this.destroy=function(){},this.alert=function(e,i,t,n,o){var a=$(c.createDOM(l,{type:e,title:i,content:t}));m.prepend(a),(void 0==n||n)&&setTimeout(function(){a.fadeOut(a.remove)},o||2e3)}}var t='<div class="euploader-root"><div class="euploader-btns"><div id="picker">选择文件</div><a id="euploader-ctl-btn" class="btn btn-default euploader-ctl-btn">开始上传</a></div><div class="euploader-list-container"><div id="euploader-list" class="euploader-list"></div></div></div>',n='<div id="{%id%}" class="tile-item {%status%}"><div class="euploader-item-info tile-info"><div class="euploader-item-status tile-status state-color"><span>{%statusIcon%}</span></div><div class="euploader-item-state tile-state state-color">{%state%}</div><div class="euploader-item-btns tile-btns"><a class="euploader-del-btn" data-file="{%id%}"><i class="glyphicon glyphicon-trash"></i></a></div></div><div class="euploader-item-input"><input name="{%files%}[]" type="hidden" value="{%value%}" {%disabled%}/></div><li class="tile-playicon"><span class="glyphicon glyphicon-play-circle"></span></li></div>',o="<span>【{%text%}】</span>",a='<div class="progress" style="margin: 0 25px 0 25px;height: 14px;"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;font-size: 10px;line-height: 14px;">{%value%}</div></div>',l='<div class="alert alert-{%type%} alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>{%title%}!</strong> {%content%}</div>',r='<i class="glyphicon glyphicon-time"></i>',s='<i class="glyphicon glyphicon-upload"></i>',d='<i class="glyphicon glyphicon-ok"></i>',u='<i class="glyphicon glyphicon-remove"></i>',c=e.StringUtils,p={doc:["doc","docx"],xls:["xls","xlsx"],ppt:["ppt","pptx"],ai:["ai"],audio:["mp3","wma"],gif:["gif"],jpg:["jpg","jpeg"],pdf:["pdf"],psd:["psd"],video:["mp4","avi","mpg","wmv","rmvb","rm","mov"],zip:["zip","rar","tar","gz"]};return i}),define("euploader",["wskeee","uploader","filelist.view","tile.view","fileutil"],function(e,i,t,n,o){return window.euploader={Wskeee:e,Uploader:i,FilelistView:t,TileView:n,FileUtil:o},window.euploader})}(window);